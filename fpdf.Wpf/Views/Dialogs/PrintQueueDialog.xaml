<hc:Window
  x:Class="fpdf.Wpf.Views.Dialogs.PrintQueueDialog"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:models="clr-namespace:fpdf.Core.Models;assembly=fpdf.Core"
  xmlns:vm="clr-namespace:fpdf.Wpf.ViewModels"
  Title="Fila de Impressão"
  Width="500"
  Height="450"
  d:DataContext="{d:DesignInstance Type=vm:PrintQueueViewModel}"
  BorderBrush="{DynamicResource BorderBrush}"
  BorderThickness="1"
  ResizeMode="CanResizeWithGrip"
  ShowInTaskbar="False"
  Style="{StaticResource WindowWin10}"
  SystemBackdropType="Acrylic"
  WindowStartupLocation="CenterOwner"
  mc:Ignorable="d">

  <hc:Window.Resources>
    <!--  Estilo customizado do ListBoxItem com efeitos visuais  -->
    <Style
      x:Key="CustomListBoxItemStyle"
      BasedOn="{StaticResource ListBoxItemBaseStyle}"
      TargetType="ListBoxItem">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="BorderBrush" Value="Transparent" />
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
        </Trigger>
        <Trigger Property="IsSelected" Value="True">
          <Setter Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
          <Setter Property="Foreground" Value="{DynamicResource TextIconBrush}" />
          <Setter Property="BorderBrush" Value="{DynamicResource SecondaryBorderBrush}" />
        </Trigger>
      </Style.Triggers>
    </Style>
  </hc:Window.Resources>

  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  Impressora e config  -->
    <Grid Grid.Row="0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <StackPanel Grid.Column="0" Orientation="Horizontal">
        <icon:PackIconPhosphorIcons
          Width="20"
          Height="20"
          Margin="0,0,8,0"
          VerticalAlignment="Center"
          Foreground="{DynamicResource PrimaryBrush}"
          Kind="Printer" />
        <TextBlock
          VerticalAlignment="Center"
          FontSize="14"
          FontWeight="SemiBold"
          Text="{Binding SelectedPrinter.DisplayName, FallbackValue='Nenhuma impressora'}" />
      </StackPanel>

      <hc:NumericUpDown
        Grid.Column="1"
        Width="80"
        Margin="8,0,0,0"
        hc:TitleElement.Title="Cópias"
        hc:TitleElement.TitlePlacement="Left"
        Maximum="100"
        Minimum="1"
        Value="{Binding Copies}" />

      <CheckBox
        Grid.Column="2"
        Margin="16,0,0,0"
        VerticalAlignment="Center"
        Content="Duplex"
        IsChecked="{Binding Duplex}" />
    </Grid>

    <!--  Contadores  -->
    <StackPanel
      Grid.Row="1"
      Margin="0,12,0,0"
      Orientation="Horizontal">
      <TextBlock Foreground="{DynamicResource SecondaryTextBrush}">
        <Run Text="{Binding PendingCount, Mode=OneWay}" />
        <Run Text="na fila" />
      </TextBlock>
      <TextBlock
        Margin="16,0,0,0"
        Foreground="{DynamicResource SuccessBrush}"
        Visibility="{Binding CompletedCount, Converter={StaticResource Int2VisibilityConverter}}">
        <Run Text="{Binding CompletedCount, Mode=OneWay}" />
        <Run Text="concluído(s)" />
      </TextBlock>
      <TextBlock
        Margin="16,0,0,0"
        Foreground="{DynamicResource DangerBrush}"
        Visibility="{Binding FailedCount, Converter={StaticResource Int2VisibilityConverter}}">
        <Run Text="{Binding FailedCount, Mode=OneWay}" />
        <Run Text="erro(s)" />
      </TextBlock>
    </StackPanel>

    <!--  Lista de jobs  -->
    <Border
      Grid.Row="2"
      Margin="0,12,0,0"
      Padding="0"
      Style="{StaticResource BorderRegion}">
      <Grid>
        <ListBox
          HorizontalContentAlignment="Stretch"
          BorderThickness="0"
          ItemsSource="{Binding Jobs}"
          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
          Style="{StaticResource ListBox.Small}"
          Visibility="{Binding Jobs.Count, Converter={StaticResource Int2VisibilityConverter}}">
          <ListBox.ItemContainerStyle>
            <Style BasedOn="{StaticResource CustomListBoxItemStyle}" TargetType="ListBoxItem" />
          </ListBox.ItemContainerStyle>
          <ListBox.ItemTemplate>
            <DataTemplate DataType="{x:Type models:PrintJob}">
              <Grid Margin="4">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Icone de status  -->
                <icon:PackIconPhosphorIcons
                  Grid.Column="0"
                  Width="16"
                  Height="16"
                  Margin="0,0,10,0"
                  VerticalAlignment="Center">
                  <icon:PackIconPhosphorIcons.Style>
                    <Style TargetType="icon:PackIconPhosphorIcons">
                      <Setter Property="Kind" Value="Clock" />
                      <Setter Property="Foreground" Value="{DynamicResource WarningBrush}" />
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding Status}" Value="Printing">
                          <Setter Property="Kind" Value="Printer" />
                          <Setter Property="Foreground" Value="{DynamicResource InfoBrush}" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Completed">
                          <Setter Property="Kind" Value="Check" />
                          <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Failed">
                          <Setter Property="Kind" Value="X" />
                          <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                          <Setter Property="Kind" Value="Prohibit" />
                          <Setter Property="Foreground" Value="{DynamicResource SecondaryTextBrush}" />
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </icon:PackIconPhosphorIcons.Style>
                </icon:PackIconPhosphorIcons>

                <!--  Nome do arquivo  -->
                <TextBlock
                  Grid.Column="1"
                  VerticalAlignment="Center"
                  Text="{Binding FileName}"
                  TextTrimming="CharacterEllipsis" />

                <!--  Copias  -->
                <TextBlock
                  Grid.Column="2"
                  Margin="10,0"
                  VerticalAlignment="Center"
                  Foreground="{DynamicResource SecondaryTextBrush}"
                  Text="{Binding Copies, StringFormat='x{0}'}" />

                <!--  Botao remover  -->
                <Button
                  Grid.Column="3"
                  Command="{Binding DataContext.CancelJobCommand, RelativeSource={RelativeSource AncestorType=hc:Window}}"
                  CommandParameter="{Binding}"
                  Style="{StaticResource ButtonIconCustom}"
                  ToolTip="Remover">
                  <icon:PackIconPhosphorIcons
                    Width="14"
                    Height="14"
                    Kind="X">
                    <icon:PackIconPhosphorIcons.Style>
                      <Style TargetType="icon:PackIconPhosphorIcons">
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}" Value="True">
                            <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </icon:PackIconPhosphorIcons.Style>
                  </icon:PackIconPhosphorIcons>
                </Button>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>

        <!--  Placeholder vazio  -->
        <StackPanel
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Visibility="{Binding Jobs.Count, Converter={StaticResource Int2VisibilityReConverter}}">
          <icon:PackIconPhosphorIcons
            Width="48"
            Height="48"
            HorizontalAlignment="Center"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Kind="Queue" />
          <TextBlock
            Margin="0,8,0,0"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Text="Fila de impressão vazia" />
        </StackPanel>
      </Grid>
    </Border>

    <!--  Botoes  -->
    <Grid Grid.Row="3" Margin="0,16,0,0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <Button
        Grid.Column="0"
        Command="{Binding ClearCompletedCommand}"
        Content="Limpar Concluídos" />

      <Button
        Grid.Column="2"
        MinWidth="120"
        Command="{Binding PrintQueueCommand}"
        IsEnabled="{Binding IsPrinting, Converter={StaticResource Boolean2BooleanReConverter}}"
        Style="{StaticResource ButtonPrimary}">
        <StackPanel Orientation="Horizontal">
          <icon:PackIconPhosphorIcons
            Width="16"
            Height="16"
            Kind="Printer" />
          <TextBlock Margin="8,0,0,0" Text="Imprimir Tudo" />
        </StackPanel>
      </Button>
    </Grid>
  </Grid>
</hc:Window>
