<hc:Window
  x:Class="fpdf.Wpf.Views.Dialogs.SettingsDialog"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:behaviors="clr-namespace:fpdf.Wpf.Behaviors"
  xmlns:control="clr-namespace:fpdf.Wpf.Views.Controls"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:ext="clr-namespace:fpdf.Wpf.Extensions"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:fpdf.Wpf.ViewModels"
  Title="{ext:Loc Settings_Title}"
  Width="500"
  Height="600"
  d:DataContext="{d:DesignInstance Type=vm:SettingsViewModel}"
  ResizeMode="NoResize"
  ShowInTaskbar="False"
  Style="{StaticResource WindowWin10}"
  SystemBackdropType="Mica"
  WindowStartupLocation="CenterOwner"
  mc:Ignorable="d">

  <hc:Window.Resources>
    <!--  Estilo customizado do ListBoxItem com efeitos visuais  -->
    <Style
      x:Key="CustomListBoxItemStyle"
      BasedOn="{StaticResource ListBoxItemBaseStyle}"
      TargetType="ListBoxItem">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="BorderBrush" Value="Transparent" />
      <Setter Property="Margin" Value="0,2" />
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
        </Trigger>
        <Trigger Property="IsSelected" Value="True">
          <Setter Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
          <Setter Property="Foreground" Value="{DynamicResource TextIconBrush}" />
          <Setter Property="BorderBrush" Value="{DynamicResource SecondaryBorderBrush}" />
        </Trigger>
      </Style.Triggers>
    </Style>
  </hc:Window.Resources>

  <Grid Margin="0">
    <Grid.RowDefinitions>
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <hc:ScrollViewer
      Grid.Row="0"
      IsInertiaEnabled="True"
      VerticalScrollBarVisibility="Auto">
      <StackPanel Margin="20">
        <!--  Impressao  -->
        <control:SettingsSection Title="{ext:Loc Settings_Printing}">
          <control:SettingsSection.SectionContent>
            <StackPanel>
              <control:SettingsItem Label="{ext:Loc Settings_DefaultPrinter}">
                <control:SettingsItem.ItemContent>
                  <ComboBox
                    Width="300"
                    DisplayMemberPath="DisplayName"
                    ItemsSource="{Binding Printers}"
                    SelectedValue="{Binding DefaultPrinter}"
                    SelectedValuePath="Name"
                    Style="{StaticResource ComboBox.Small}" />
                </control:SettingsItem.ItemContent>
              </control:SettingsItem>

              <Border Height="1" Background="{DynamicResource BorderBrush}" />

              <control:SettingsItem Label="{ext:Loc Settings_DefaultCopies}">
                <control:SettingsItem.ItemContent>
                  <hc:NumericUpDown
                    Width="100"
                    Maximum="100"
                    Minimum="1"
                    Style="{StaticResource NumericUpDown.Small}"
                    Value="{Binding DefaultCopies}" />
                </control:SettingsItem.ItemContent>
              </control:SettingsItem>

              <Border Height="1" Background="{DynamicResource BorderBrush}" />

              <control:SettingsToggleItem IsChecked="{Binding DefaultDuplex}" Label="{ext:Loc Settings_DoubleSided}" />
            </StackPanel>
          </control:SettingsSection.SectionContent>
        </control:SettingsSection>

        <!--  Aparencia  -->
        <control:SettingsSection Title="{ext:Loc Settings_Appearance}">
          <control:SettingsSection.SectionContent>
            <StackPanel>
              <control:SettingsItem Label="{ext:Loc Settings_Language}">
                <control:SettingsItem.ItemContent>
                  <ComboBox
                    Width="200"
                    DisplayMemberPath="NativeName"
                    ItemsSource="{Binding AvailableLanguages}"
                    SelectedItem="{Binding SelectedLanguage}"
                    Style="{StaticResource ComboBox.Small}" />
                </control:SettingsItem.ItemContent>
              </control:SettingsItem>

              <Border Height="1" Background="{DynamicResource BorderBrush}" />

              <control:SettingsItem Label="{ext:Loc Settings_Theme}">
                <control:SettingsItem.ItemContent>
                  <ComboBox
                    Width="150"
                    ItemsSource="{Binding AvailableThemes}"
                    SelectedItem="{Binding Theme}"
                    Style="{StaticResource ComboBox.Small}" />
                </control:SettingsItem.ItemContent>
              </control:SettingsItem>

              <Border Height="1" Background="{DynamicResource BorderBrush}" />

              <control:SettingsToggleItem IsChecked="{Binding ShowThumbnails}" Label="{ext:Loc Settings_ShowThumbnails}" />

              <Border Height="1" Background="{DynamicResource BorderBrush}" />

              <control:SettingsItem Label="{ext:Loc Settings_ThumbnailSize}">
                <control:SettingsItem.ItemContent>
                  <StackPanel Width="200" Orientation="Horizontal">
                    <Slider
                      Width="158"
                      Margin="0,0,10,0"
                      IsSnapToTickEnabled="True"
                      Maximum="128"
                      Minimum="32"
                      TickFrequency="16"
                      Value="{Binding ThumbnailSize}" />
                    <TextBlock
                      HorizontalAlignment="Right"
                      Foreground="{DynamicResource SecondaryTextBrush}"
                      Text="{Binding ThumbnailSize, StringFormat='{}{0}px'}" />
                  </StackPanel>
                </control:SettingsItem.ItemContent>
              </control:SettingsItem>
            </StackPanel>
          </control:SettingsSection.SectionContent>
        </control:SettingsSection>

        <!--  Navegacao  -->
        <control:SettingsSection Title="{ext:Loc Settings_General}">
          <control:SettingsSection.SectionContent>
            <control:SettingsToggleItem IsChecked="{Binding RememberLastFolder}" Label="{ext:Loc Settings_RememberLastFolder}" />
          </control:SettingsSection.SectionContent>
        </control:SettingsSection>

        <!--  Arquivos  -->
        <control:SettingsSection Title="{ext:Loc Settings_Files}">
          <control:SettingsSection.SectionContent>
            <StackPanel>
              <control:SettingsToggleItem
                Description="{ext:Loc Settings_RecursiveSearchDesc}"
                IsChecked="{Binding RecursiveSearch}"
                Label="{ext:Loc Settings_RecursiveSearch}" />

              <Border Height="1" Background="{DynamicResource BorderBrush}" />

              <control:SettingsItem Description="{ext:Loc Settings_SupportedExtensionsDesc}" Label="{ext:Loc Settings_SupportedExtensions}">
                <control:SettingsItem.ItemContent>
                  <hc:TextBox
                    Width="250"
                    Style="{StaticResource TextBox.Small}"
                    Text="{Binding SupportedExtensions, UpdateSourceTrigger=PropertyChanged}" />
                </control:SettingsItem.ItemContent>
              </control:SettingsItem>
            </StackPanel>
          </control:SettingsSection.SectionContent>
        </control:SettingsSection>

        <!--  Diretorios de Rede  -->
        <control:SettingsSection Title="{ext:Loc Settings_NetworkDirectories}">
          <control:SettingsSection.SectionContent>
            <StackPanel>
              <!--  Campo para adicionar  -->
              <Border
                Margin="0,0,0,8"
                Padding="0"
                BorderThickness="0,0,0,1"
                CornerRadius="4,4,0,0"
                Style="{StaticResource BorderRegion}">
                <Grid>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>

                  <hc:TextBox
                    hc:InfoElement.Placeholder="\\servidor\pasta"
                    Background="Transparent"
                    BorderThickness="0"
                    Text="{Binding NewNetworkPath, UpdateSourceTrigger=PropertyChanged}">
                    <hc:TextBox.InputBindings>
                      <KeyBinding Key="Return" Command="{Binding AddNetworkPathCommand}" />
                    </hc:TextBox.InputBindings>
                  </hc:TextBox>

                  <Button
                    Grid.Column="1"
                    Width="24"
                    Height="24"
                    Margin="0,0,13,0"
                    Command="{Binding AddNetworkPathCommand}"
                    Style="{StaticResource ButtonIconCustom}"
                    ToolTip="{ext:Loc Settings_AddDirectory}">
                    <icon:PackIconPhosphorIcons
                      Width="12"
                      Height="12"
                      Kind="PlusBold" />
                  </Button>
                </Grid>

              </Border>

              <!--  Lista de diretorios  -->
              <Grid>
                <ListBox
                  MaxHeight="150"
                  HorizontalContentAlignment="Stretch"
                  Background="Transparent"
                  BorderThickness="0"
                  ItemsSource="{Binding CustomNetworkPaths}"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                  Style="{StaticResource ListBox.Small}">
                  <ListBox.ItemContainerStyle>
                    <Style BasedOn="{StaticResource CustomListBoxItemStyle}" TargetType="ListBoxItem" />
                  </ListBox.ItemContainerStyle>
                  <ListBox.ItemTemplate>
                    <DataTemplate>
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="Auto" />
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <icon:PackIconPhosphorIcons
                          Width="16"
                          Height="16"
                          Margin="0,0,8,0"
                          VerticalAlignment="Center"
                          Foreground="{DynamicResource PrimaryBrush}"
                          Kind="Network" />

                        <TextBlock
                          Grid.Column="1"
                          VerticalAlignment="Center"
                          Text="{Binding}"
                          TextTrimming="CharacterEllipsis" />

                        <Button
                          Grid.Column="2"
                          Command="{Binding DataContext.RemoveNetworkPathCommand, RelativeSource={RelativeSource AncestorType=hc:Window}}"
                          CommandParameter="{Binding}"
                          Style="{StaticResource ButtonIconCustom}"
                          ToolTip="{ext:Loc Settings_Remove}">
                          <icon:PackIconPhosphorIcons
                            Width="12"
                            Height="12"
                            Kind="X">
                            <icon:PackIconPhosphorIcons.Style>
                              <Style TargetType="icon:PackIconPhosphorIcons">
                                <Style.Triggers>
                                  <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}" Value="True">
                                    <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                                  </DataTrigger>
                                </Style.Triggers>
                              </Style>
                            </icon:PackIconPhosphorIcons.Style>
                          </icon:PackIconPhosphorIcons>
                        </Button>
                      </Grid>
                    </DataTemplate>
                  </ListBox.ItemTemplate>
                </ListBox>

                <TextBlock
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Foreground="{DynamicResource SecondaryTextBrush}"
                  Text="{ext:Loc Settings_NoNetworkDir}"
                  Visibility="{Binding CustomNetworkPaths.Count, Converter={StaticResource Int2VisibilityReConverter}}" />
              </Grid>
            </StackPanel>
          </control:SettingsSection.SectionContent>
        </control:SettingsSection>

        <!--  Pastas favoritas  -->
        <control:SettingsSection Title="{ext:Loc Settings_FavoriteFolders}">
          <control:SettingsSection.SectionContent>
            <Grid>
              <ListBox
                MaxHeight="150"
                HorizontalContentAlignment="Stretch"
                Background="Transparent"
                BorderThickness="0"
                ItemsSource="{Binding FavoriteFolders}"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                Style="{StaticResource ListBox.Small}">
                <ListBox.ItemContainerStyle>
                  <Style BasedOn="{StaticResource CustomListBoxItemStyle}" TargetType="ListBoxItem" />
                </ListBox.ItemContainerStyle>
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                      </Grid.ColumnDefinitions>

                      <TextBlock
                        VerticalAlignment="Center"
                        Text="{Binding}"
                        TextTrimming="CharacterEllipsis" />

                      <Button
                        Grid.Column="1"
                        Command="{Binding DataContext.RemoveFavoriteFolderCommand, RelativeSource={RelativeSource AncestorType=hc:Window}}"
                        CommandParameter="{Binding}"
                        Style="{StaticResource ButtonIconCustom}"
                        ToolTip="{ext:Loc Settings_Remove}">
                        <icon:PackIconPhosphorIcons
                          Width="12"
                          Height="12"
                          Kind="X">
                          <icon:PackIconPhosphorIcons.Style>
                            <Style TargetType="icon:PackIconPhosphorIcons">
                              <Style.Triggers>
                                <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}" Value="True">
                                  <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                                </DataTrigger>
                              </Style.Triggers>
                            </Style>
                          </icon:PackIconPhosphorIcons.Style>
                        </icon:PackIconPhosphorIcons>
                      </Button>
                    </Grid>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>

              <TextBlock
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Foreground="{DynamicResource SecondaryTextBrush}"
                Text="{ext:Loc Settings_NoFavorites}"
                Visibility="{Binding FavoriteFolders.Count, Converter={StaticResource Int2VisibilityReConverter}}" />
            </Grid>
          </control:SettingsSection.SectionContent>
        </control:SettingsSection>

        <!--  Pastas recentes  -->
        <control:SettingsSection Title="{ext:Loc Settings_RecentFolders}" Margin="0,0,0,70">
          <control:SettingsSection.SectionContent>
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
              </Grid.RowDefinitions>

              <ListBox
                MaxHeight="100"
                Background="Transparent"
                BorderThickness="0"
                ItemsSource="{Binding RecentFolders}"
                Style="{StaticResource ListBox.Small}">
                <ListBox.ItemContainerStyle>
                  <Style BasedOn="{StaticResource CustomListBoxItemStyle}" TargetType="ListBoxItem" />
                </ListBox.ItemContainerStyle>
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding}" TextTrimming="CharacterEllipsis" />
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>

              <Button
                Grid.Row="1"
                Margin="0,8,8,8"
                HorizontalAlignment="Right"
                Command="{Binding ClearRecentFoldersCommand}"
                Content="{ext:Loc Settings_ClearHistory}" />
            </Grid>
          </control:SettingsSection.SectionContent>
        </control:SettingsSection>
      </StackPanel>
    </hc:ScrollViewer>

    <!--  Botoes flutuantes  -->
    <Border
      x:Name="ButtonsBorder"
      Grid.Row="0"
      Height="60"
      Padding="16,10"
      VerticalAlignment="Bottom"
      Background="Transparent">
      <Border.Effect>
        <DropShadowEffect
          BlurRadius="16"
          Direction="90"
          Opacity="0.3"
          ShadowDepth="2"
          Color="Black" />
      </Border.Effect>

      <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
        <Button
          Width="100"
          Click="Cancel_Click"
          Content="{ext:Loc Settings_Cancel}"
          IsCancel="True" />
        <Button
          Width="100"
          Margin="8,0,0,0"
          Click="Save_Click"
          Content="{ext:Loc Settings_Save}"
          Style="{StaticResource ButtonPrimary}" />
      </StackPanel>
    </Border>
  </Grid>
</hc:Window>
