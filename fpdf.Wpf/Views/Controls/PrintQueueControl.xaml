<UserControl
  x:Class="fpdf.Wpf.Views.Controls.PrintQueueControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:models="clr-namespace:fpdf.Core.Models;assembly=fpdf.Core"
  xmlns:vm="clr-namespace:fpdf.Wpf.ViewModels"
  d:DataContext="{d:DesignInstance Type=vm:PrintQueueViewModel}"
  mc:Ignorable="d">

  <Border Style="{StaticResource BorderRegion}">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <!--  Selecao de impressora e configuracoes  -->
      <Grid Grid.Row="0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <ComboBox
          Grid.Column="0"
          hc:InfoElement.Placeholder="Selecione a impressora"
          DisplayMemberPath="DisplayName"
          ItemsSource="{Binding Printers}"
          SelectedItem="{Binding SelectedPrinter}" />

        <hc:NumericUpDown
          Grid.Column="1"
          Width="80"
          Margin="8,0,0,0"
          hc:InfoElement.Placeholder="Copias"
          Maximum="100"
          Minimum="1"
          Value="{Binding Copies}" />

        <CheckBox
          Grid.Column="2"
          Margin="8,0,0,0"
          VerticalAlignment="Center"
          Content="Duplex"
          IsChecked="{Binding Duplex}" />

        <Button
          Grid.Column="3"
          Margin="8,0,0,0"
          Command="{Binding SetDefaultPrinterCommand}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Definir como padrao">
          <icon:PackIconPhosphorIcons Kind="Star" />
        </Button>
      </Grid>

      <!--  Opcoes de paginas  -->
      <StackPanel
        Grid.Row="1"
        Margin="0,8,0,0"
        Orientation="Horizontal">
        <TextBlock VerticalAlignment="Center" Text="Paginas:" />
        <RadioButton
          Margin="8,0,0,0"
          Checked="AllPages_Checked"
          Content="Todas"
          GroupName="PageRange"
          IsChecked="True" />
        <RadioButton
          x:Name="RangeRadio"
          Margin="8,0,0,0"
          Content="Intervalo:"
          GroupName="PageRange" />
        <hc:TextBox
          Width="80"
          Margin="4,0,0,0"
          hc:InfoElement.Placeholder="1-5"
          IsEnabled="{Binding IsChecked, ElementName=RangeRadio}"
          Text="{Binding PageRange, UpdateSourceTrigger=PropertyChanged}" />
      </StackPanel>

      <!--  Lista de jobs  -->
      <ListBox
        Grid.Row="2"
        MaxHeight="200"
        Margin="0,8,0,0"
        ItemsSource="{Binding Jobs}">
        <ListBox.ItemTemplate>
          <DataTemplate DataType="{x:Type models:PrintJob}">
            <Grid Margin="4">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <!--  Icone de status  -->
              <icon:PackIconPhosphorIcons
                Grid.Column="0"
                Width="16"
                Height="16"
                Margin="0,0,8,0">
                <icon:PackIconPhosphorIcons.Style>
                  <Style TargetType="icon:PackIconPhosphorIcons">
                    <Setter Property="Kind" Value="Clock" />
                    <Setter Property="Foreground" Value="{DynamicResource WarningBrush}" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Status}" Value="Printing">
                        <Setter Property="Kind" Value="Printer" />
                        <Setter Property="Foreground" Value="{DynamicResource InfoBrush}" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Status}" Value="Completed">
                        <Setter Property="Kind" Value="Check" />
                        <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Status}" Value="Failed">
                        <Setter Property="Kind" Value="X" />
                        <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                        <Setter Property="Kind" Value="Prohibit" />
                        <Setter Property="Foreground" Value="{DynamicResource SecondaryTextBrush}" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </icon:PackIconPhosphorIcons.Style>
              </icon:PackIconPhosphorIcons>

              <!--  Nome do arquivo  -->
              <StackPanel Grid.Column="1">
                <TextBlock Text="{Binding FileName}" TextTrimming="CharacterEllipsis" />
                <TextBlock
                  FontSize="11"
                  Foreground="{DynamicResource SecondaryTextBrush}"
                  Text="{Binding StatusText}" />
              </StackPanel>

              <!--  Copias  -->
              <TextBlock
                Grid.Column="2"
                Margin="8,0"
                VerticalAlignment="Center"
                Text="{Binding Copies, StringFormat='x{0}'}" />

              <!--  Botao cancelar  -->
              <Button
                Grid.Column="3"
                Command="{Binding DataContext.CancelJobCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}"
                Style="{StaticResource ButtonIcon}"
                ToolTip="Cancelar">
                <icon:PackIconPhosphorIcons
                  Width="12"
                  Height="12"
                  Kind="X" />
              </Button>
            </Grid>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>

      <!--  Barra de acoes  -->
      <Grid Grid.Row="3" Margin="0,8,0,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!--  Contadores  -->
        <StackPanel
          Grid.Column="0"
          VerticalAlignment="Center"
          Orientation="Horizontal">
          <TextBlock>
            <Run Text="{Binding PendingCount, Mode=OneWay}" />
            <Run Text="pendente(s)" />
          </TextBlock>
          <TextBlock
            Margin="8,0,0,0"
            Foreground="{DynamicResource SuccessBrush}"
            Visibility="{Binding CompletedCount, Converter={StaticResource Int2VisibilityConverter}}">
            <Run Text="{Binding CompletedCount, Mode=OneWay}" />
            <Run Text="concluido(s)" />
          </TextBlock>
          <TextBlock
            Margin="8,0,0,0"
            Foreground="{DynamicResource DangerBrush}"
            Visibility="{Binding FailedCount, Converter={StaticResource Int2VisibilityConverter}}">
            <Run Text="{Binding FailedCount, Mode=OneWay}" />
            <Run Text="falha(s)" />
          </TextBlock>
        </StackPanel>

        <!--  Botoes de acao  -->
        <Button
          Grid.Column="1"
          Margin="4,0"
          Command="{Binding ClearCompletedCommand}"
          Content="Limpar" />

        <Button
          Grid.Column="2"
          Margin="4,0"
          Command="{Binding CancelAllJobsCommand}"
          Content="Cancelar Tudo" />

        <Button
          Grid.Column="3"
          Command="{Binding PrintQueueCommand}"
          Content="Imprimir Fila"
          IsEnabled="{Binding IsPrinting, Converter={StaticResource Boolean2BooleanReConverter}}"
          Style="{StaticResource ButtonPrimary}">
          <Button.ContentTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal">
                <icon:PackIconPhosphorIcons
                  Width="16"
                  Height="16"
                  Kind="Printer" />
                <TextBlock Margin="8,0,0,0" Text="Imprimir Fila" />
              </StackPanel>
            </DataTemplate>
          </Button.ContentTemplate>
        </Button>
      </Grid>
    </Grid>
  </Border>
</UserControl>
