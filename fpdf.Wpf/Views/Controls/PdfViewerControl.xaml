<UserControl
  x:Class="fpdf.Wpf.Views.Controls.PdfViewerControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:fpdf.Wpf.ViewModels"
  d:DataContext="{d:DesignInstance Type=vm:PdfViewerViewModel}"
  mc:Ignorable="d">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  Barra de ferramentas  -->
    <Border
      Grid.Row="0"
      Padding="4"
      Background="{DynamicResource RegionBrush}">
      <StackPanel Orientation="Horizontal">
        <!--  Navegacao de paginas  -->
        <Button
          Command="{Binding FirstPageCommand}"
          IsEnabled="{Binding HasPreviousPage}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Primeira pagina">
          <icon:PackIconPhosphorIcons Kind="CaretDoubleLeft" />
        </Button>

        <Button
          Command="{Binding PreviousPageCommand}"
          IsEnabled="{Binding HasPreviousPage}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Pagina anterior">
          <icon:PackIconPhosphorIcons Kind="CaretLeft" />
        </Button>

        <TextBlock
          MinWidth="60"
          Margin="8,0"
          VerticalAlignment="Center"
          Text="{Binding PageInfo}"
          TextAlignment="Center" />

        <Button
          Command="{Binding NextPageCommand}"
          IsEnabled="{Binding HasNextPage}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Proxima pagina">
          <icon:PackIconPhosphorIcons Kind="CaretRight" />
        </Button>

        <Button
          Command="{Binding LastPageCommand}"
          IsEnabled="{Binding HasNextPage}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Ultima pagina">
          <icon:PackIconPhosphorIcons Kind="CaretDoubleRight" />
        </Button>

        <Separator Margin="8,0" Style="{StaticResource VerticalSeparator}" />

        <!--  Zoom  -->
        <Button
          Command="{Binding ZoomOutCommand}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Diminuir zoom">
          <icon:PackIconPhosphorIcons Kind="MagnifyingGlassMinus" />
        </Button>

        <TextBlock
          MinWidth="50"
          Margin="8,0"
          VerticalAlignment="Center"
          Text="{Binding Zoom, StringFormat='{}{0:P0}'}"
          TextAlignment="Center" />

        <Button
          Command="{Binding ZoomInCommand}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Aumentar zoom">
          <icon:PackIconPhosphorIcons Kind="MagnifyingGlassPlus" />
        </Button>

        <Button
          Command="{Binding ResetZoomCommand}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Zoom 100%">
          <icon:PackIconPhosphorIcons Kind="Equals" />
        </Button>

        <Separator Margin="8,0" Style="{StaticResource VerticalSeparator}" />

        <!--  Rotacao  -->
        <Button
          Command="{Binding RotateCounterClockwiseCommand}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Girar anti-horario">
          <icon:PackIconPhosphorIcons Kind="ArrowCounterClockwise" />
        </Button>

        <Button
          Command="{Binding RotateClockwiseCommand}"
          Style="{StaticResource ButtonIcon}"
          ToolTip="Girar horario">
          <icon:PackIconPhosphorIcons Kind="ArrowClockwise" />
        </Button>
      </StackPanel>
    </Border>

    <!--  Area de visualizacao do PDF  -->
    <ScrollViewer
      Grid.Row="1"
      Background="{DynamicResource SecondaryRegionBrush}"
      HorizontalScrollBarVisibility="Auto"
      VerticalScrollBarVisibility="Auto">
      <Grid>
        <!--  Imagem da pagina  -->
        <Border
          Margin="20"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Background="White"
          Effect="{DynamicResource EffectShadow2}">
          <Image
            RenderTransformOrigin="0.5,0.5"
            Source="{Binding CurrentPage}"
            Stretch="None">
            <Image.RenderTransform>
              <RotateTransform Angle="{Binding Rotation}" />
            </Image.RenderTransform>
          </Image>
        </Border>

        <!--  Placeholder quando nao ha arquivo  -->
        <StackPanel
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Visibility="{Binding CurrentFile, Converter={StaticResource Object2VisibilityReConverter}}">
          <icon:PackIconPhosphorIcons
            Width="64"
            Height="64"
            HorizontalAlignment="Center"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Kind="FilePdf" />
          <TextBlock
            Margin="0,16,0,0"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Text="Selecione um PDF para visualizar" />
        </StackPanel>

        <!--  Mensagem de erro  -->
        <Border
          Padding="16"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Background="{DynamicResource DangerBrush}"
          CornerRadius="4"
          Visibility="{Binding ErrorMessage, Converter={StaticResource Object2VisibilityConverter}}">
          <StackPanel>
            <icon:PackIconPhosphorIcons
              Width="32"
              Height="32"
              HorizontalAlignment="Center"
              Foreground="White"
              Kind="Warning" />
            <TextBlock
              MaxWidth="300"
              Margin="0,8,0,0"
              Foreground="White"
              Text="{Binding ErrorMessage}"
              TextWrapping="Wrap" />
          </StackPanel>
        </Border>

        <!--  Loading  -->
        <Border Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityConverter}}">
          <hc:LoadingCircle />
        </Border>
      </Grid>
    </ScrollViewer>

    <!--  Info do arquivo atual  -->
    <Border
      Grid.Row="2"
      Padding="8,4"
      Background="{DynamicResource RegionBrush}">
      <TextBlock
        Text="{Binding CurrentFile.FileName, FallbackValue='Nenhum arquivo selecionado'}"
        TextTrimming="CharacterEllipsis"
        ToolTip="{Binding CurrentFile.FullPath}" />
    </Border>
  </Grid>
</UserControl>
