<UserControl
  x:Class="fpdf.Wpf.Views.Controls.PdfViewerControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:preview="clr-namespace:fpdf.Wpf.Controls.PreviewHandler"
  xmlns:vm="clr-namespace:fpdf.Wpf.ViewModels"
  d:DataContext="{d:DesignInstance Type=vm:PdfViewerViewModel}"
  mc:Ignorable="d">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  Barra de ferramentas simplificada  -->
    <Border
      Grid.Row="0"
      Margin="5,5,5,0"
      Background="{DynamicResource DarkOpacityBrush}"
      BorderBrush="{DynamicResource BorderBrush}"
      BorderThickness="1"
      CornerRadius="4,4,0,0">
      <StackPanel Orientation="Horizontal">
        <Button
          Click="OnOpenExternalClick"
          Style="{StaticResource ButtonIconCustom}"
          ToolTip="Abrir no aplicativo padrão">
          <icon:PackIconPhosphorIcons Kind="ArrowSquareOut" />
        </Button>

        <hc:Divider
          MaxHeight="16"
          LineStrokeThickness="2"
          Orientation="Vertical" />

        <TextBlock
          Margin="8,0"
          VerticalAlignment="Center"
          Foreground="{DynamicResource SecondaryTextBrush}"
          Text="Visualização usando o aplicativo padrão do sistema" />
      </StackPanel>
    </Border>

    <!--  Area de visualizacao do PDF via Preview Handler  -->
    <Border
      Grid.Row="1"
      Margin="5,0"
      Background="{DynamicResource SecondaryRegionBrush}"
      BorderBrush="{DynamicResource BorderBrush}"
      BorderThickness="1,0,1,0">
      <Grid>
        <!--  Preview Handler Host  -->
        <preview:PreviewHandlerHost x:Name="PreviewHost" Visibility="{Binding CurrentFile, Converter={StaticResource Object2VisibilityConverter}}" />

        <!--  Placeholder quando nao ha arquivo  -->
        <StackPanel
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Visibility="{Binding CurrentFile, Converter={StaticResource Object2VisibilityReConverter}}">
          <icon:PackIconPhosphorIcons
            Width="64"
            Height="64"
            HorizontalAlignment="Center"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Kind="FilePdf" />
          <TextBlock
            Margin="0,16,0,0"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Text="Selecione um PDF para visualizar" />
        </StackPanel>

        <!--  Mensagem de erro  -->
        <Border
          Padding="16"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Background="{DynamicResource DangerBrush}"
          CornerRadius="4"
          Visibility="{Binding ErrorMessage, Converter={StaticResource Object2VisibilityConverter}}">
          <StackPanel>
            <icon:PackIconPhosphorIcons
              Width="32"
              Height="32"
              HorizontalAlignment="Center"
              Foreground="White"
              Kind="Warning" />
            <TextBlock
              MaxWidth="300"
              Margin="0,8,0,0"
              Foreground="White"
              Text="{Binding ErrorMessage}"
              TextWrapping="Wrap" />
          </StackPanel>
        </Border>

        <!--  Loading  -->
        <Border Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityConverter}}">
          <hc:LoadingCircle />
        </Border>
      </Grid>
    </Border>

    <!--  Info do arquivo atual  -->
    <Border
      Grid.Row="2"
      Margin="5,0"
      Padding="8,4"
      Background="{DynamicResource DarkOpacityBrush}"
      BorderBrush="{DynamicResource BorderBrush}"
      BorderThickness="1"
      CornerRadius="0,0,4,4">
      <TextBlock
        Text="{Binding CurrentFile.FileName, FallbackValue='Nenhum arquivo selecionado'}"
        TextTrimming="CharacterEllipsis"
        ToolTip="{Binding CurrentFile.FullPath}" />
    </Border>
  </Grid>
</UserControl>
